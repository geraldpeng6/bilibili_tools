## v1.1.0 (2025-10-25)
- 更新时间: 2025-10-25
- 更新类型: minor
- 更新说明: Notion集成功能重大改进和修复

### 🎯 主要功能改进
  - **Notion内容结构重构**：改进页面组织结构，所有内容直接添加到主页面
  - **AI总结自动发送**：AI总结完成后自动发送到Notion
  - **内容选项配置**：支持独立选择发送视频信息、AI总结、时间戳段落、字幕内容

### 🐛 修复的问题
  - **完全修复Notion API错误**：
    - 修复rich_text格式问题，为所有元素添加必需的`type: 'text'`属性
    - 移除无效的child_page块类型
    - 增强block结构验证，确保所有类型属性正确
    - 改进数据类型验证，确保文本内容为有效字符串
  
### 📝 优化改进
  - 限制字幕显示数量（最多100条）避免页面过长
  - 使用分隔线和标题更好地组织内容结构
  - 添加详细的错误日志，便于问题排查
  - 改进_parseRichText方法，支持粗体、代码等格式

### 📋 笔记功能增强
  - 支持AI总结笔记的保存和管理
  - 截图可按时间戳自动嵌入到对应段落
  - 改进笔记面板UI，更好地展示AI总结结构

---

## v1.0.15 (2025-10-25 01:48)
- 更新类型: patch
- 更新说明: 重构Notion笔记结构，使用子页面架构
  - **子页面架构**: AI总结和字幕不再直接添加到主笔记，改为创建子页面并引用
  - **新增方法**: _createChildPage创建子页面（父页面是普通页面，不是数据库）
  - **主笔记结构优化**: 视频信息 → 时间戳段落 → AI总结引用 → 字幕引用
  - **子页面创建**: 
    - AI总结子页面：包含完整的Markdown格式总结
    - 字幕内容子页面：包含所有字幕文本
  - **不填充总结字段**: _buildProperties方法新增summary参数，传入null时不填充"总结"字段
  - **减少blocks**: 主笔记只包含核心信息，详细内容在子页面中
  - **提升性能**: 减少主笔记blocks数量，截图查找速度更快
  - **清晰结构**: 主笔记简洁，子页面详细，信息组织更合理

---

## v1.0.15 (2025-10-25 01:44)
- 更新时间: 2025-10-25 01:44
- 更新类型: patch
- 更新说明: 修复全局错误处理器的类型安全问题
  - **修复TypeError**: 修复`t.includes is not a function`错误，使用`String()`安全转换message和source
  - **过滤第三方错误**: 添加nc-loader（阿里云验证码）和addIceCandidate错误过滤
  - **增强Promise错误处理**: 安全获取reason信息，避免类型错误
  - **更健壮的错误处理**: 所有字符串检查前先确保变量是字符串类型
  - **调试日志**: 为被过滤的错误添加调试日志，便于排查问题

---

## v1.0.14 (2025-10-25 01:42)
- 更新时间: 2025-10-25 01:42
- 更新类型: patch
- 更新说明: 优化Markdown解析器，修复标题识别和减少blocks数量
  - **修复标题识别bug**: 使用正则`/^(#{1,3})\s+(.+)$/`匹配标题，正确识别`### **关键总结**`
  - **减少blocks数量**: 合并连续的普通段落为一个paragraph，显著减少blocks（提升截图查找速度）
  - **简化rich text解析**: 移除斜体支持，只保留粗体`**text**`和代码`` `code` ``格式
  - **换行支持增强**: 正确处理多行文本的换行，在paragraph内部保留换行
  - **性能优化**: flushParagraphs机制批量处理段落，减少API请求体积
  - **调试日志**: 显示"blocks（优化后）"，便于监控优化效果

---

## v1.0.13 (2025-10-25 01:38)
- 更新时间: 2025-10-25 01:38
- 更新类型: patch
- 更新说明: 优化AGENTS.md开发指南，突出版本管理流程
  - **核心原则重组**: 将版本管理提升到核心原则第2位，强调重要性
  - **版本管理详解**: 详细说明`npm run bump`命令的作用和后续步骤
  - **开发流程简化**: 精简为4步：修改代码 → 更新版本 → 填写说明 → 提交代码
  - **结构优化**: 使用表格展示核心功能模块，更直观清晰
  - **检查清单**: 添加AI助手修改前后的检查清单，确保流程规范
  - **精简内容**: 删除冗余示例代码，保留最实用的开发提示
  - **标题优化**: 改为"AI开发助手指南"，明确文档定位

---

## v1.0.12 (2025-10-25 01:35)
- 更新时间: 2025-10-25 01:35
- 更新类型: patch
- 更新说明: AI总结在Notion中以Markdown格式显示
  - **新增Markdown解析器**: _convertMarkdownToNotionBlocks方法，完整支持Markdown语法
  - **支持的格式**:
    - 标题: `#` (heading_1), `##` (heading_2), `###` (heading_3)
    - 列表: `-` 或 `*` (bulleted_list), `1.` (numbered_list)
    - 文本样式: `**粗体**`, `*斜体*`, `` `代码` ``
    - 其他: `---` (分隔线), `> 引用`, ` ```代码块``` `
  - **Rich Text解析**: _parseRichText方法支持行内格式（粗体、斜体、代码）
  - **视频总结优化**: AI总结现在完美保留Markdown格式，在Notion中呈现更美观
  - **调试日志**: 添加详细的转换日志，记录blocks生成过程

---

## v1.0.11 (2025-10-25 01:32)
- 更新时间: 2025-10-25 01:32
- 更新类型: patch
- 更新说明: 删除字幕面板左上角的AI助手图标
  - 移除了subtitle-header-left中的AI助手图标元素
  - 删除了.subtitle-status-icon相关的CSS样式
  - 删除了ICONS.AI_ASSISTANT图标定义
  - 界面更简洁清爽

---

## v1.0.10 (2025-10-25 01:29)
- 更新时间: 2025-10-25 01:29
- 更新类型: patch
- 更新说明: 重构Notion截图智能插入功能，优化段落结构
  - **NotionService.sendAISummary**: 使用toggle block创建段落，支持添加children
  - **ScreenshotService.insertScreenshotAtTimestamp**: 改进查找逻辑，根据时间戳精准定位toggle block
  - **智能匹配算法**: 找到最接近且不大于截图时间的段落进行插入
  - **详细调试日志**: 完整记录段落构建、时间戳解析、block查找和插入过程
  - **兼容性**: 同时支持toggle和bulleted_list_item两种格式
  - **结构优化**: 每个段落现在是独立的toggle block，可以折叠展开，截图作为children嵌入其中

---

## v1.0.9 (2025-10-25 01:25)
- 更新时间: 2025-10-25 01:25
- 更新类型: patch
- 更新说明: 修复AI总结完成后自动发送Notion功能
  - 修复了main.js中AI_SUMMARY_COMPLETE事件监听器调用错误的方法
  - 从调用sendSubtitle改为正确调用sendAISummary
  - 现在AI总结完成后会根据Notion内容选项正确发送AI总结内容到Notion
  - 添加了成功和失败的通知提示

---

## v1.0.8 (2025-10-22 21:18)
- 更新时间: 2025-10-22 21:18
- 更新类型: patch
- 更新说明: 修复Notion发送字幕时的TypeError错误
  - 修复了发送字幕到Notion时`substring is not a function`错误
  - 正确处理AI总结可能是对象（含markdown和segments）或字符串的情况
  - 兼容新旧版本的AI总结数据格式

---

## v1.0.7 (2025-10-22 18:04)
- 更新时间: 2025-10-22 18:04
- 更新类型: patch
- 更新说明: 减少NotesService中鼠标事件日志输出，避免控制台日志过多
  - 注释掉mouseup/mousedown基础事件日志和鼠标位置日志
  - 只保留重要的操作日志（如检测到文本选择、保存笔记等）

---

## v1.0.6 (2025-10-22 17:54)
- 更新时间: 2025-10-22 17:54
- 更新类型: patch
- 更新说明: 优化字幕和AI段落交互体验
  - 字幕列表滚动位置改为顶部对齐：当前播放字幕显示在列表顶部而非中心
  - AI段落元素完全支持点击跳转：整个段落区域都可点击，不仅限于时间按钮
  - 添加点击反馈动画：点击AI段落时显示视觉反馈效果
  - 增强当前播放字幕高亮：添加发光动画使其更明显
  - 优化滚动边距：顶部保留20px边距以改善视觉效果

---

## v1.0.5 (2025-10-22 17:44)
- 更新时间: 2025-10-22 17:44
- 更新类型: patch
- 更新说明: 移除AI总结加载中效果
  - 修复"正在生成总结..."一直显示的问题
  - 移除UIRenderer.js中的AI总结加载状态显示
  - 移除main.js中的加载状态插入逻辑
  - 移除AI图标的loading动画状态

---

## v1.0.4 (2025-10-22 17:33)
- 更新时间: 2025-10-22 17:33
- 更新类型: patch
- 更新说明: 字幕自动滚动功能完全重构
  - 创建独立的 SubtitleScrollManager 模块，解耦滚动管理逻辑
  - 删除 EventHandlers.js 和 SubtitleEventHandler.js 中的旧滚动代码
  - 实现更精准的自动跟随：始终将当前播放字幕居中显示
  - 改进用户滚动检测机制，避免误判
  - 优化滚动性能：200ms更新频率，更流畅的体验
  - 支持配置化：滚动行为、位置、检测延迟等均可配置

---

## v1.0.3 (2025-10-22 17:27)
- 更新时间: 2025-10-22 17:27
- 更新类型: patch
- 更新说明: 
  - 修复AIService.js缺少logger导入导致的ReferenceError错误
  - 修复UIRenderer.js缺少logger导入问题  
  - 修复markdown解析空代码块显示问题，自动清理空的```代码块
  - 改进parseMarkdown方法，正确处理代码块内容

---

## v1.0.2 (2025-10-22 17:21)
- 更新时间: 2025-10-22 17:21
- 更新类型: patch
- 更新说明: 修复字幕切换过快导致关闭失败的问题，将切换延迟从1秒增加到2秒

---

## v1.0.1 (2025-10-22 17:18)
- 更新时间: 2025-10-22 17:18
- 更新类型: patch
- 更新说明: 添加自动版本管理系统，实现版本号自动更新和历史记录

---
