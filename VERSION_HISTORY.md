## v1.2.0 (2025-10-26)
- 更新时间: 2025-10-26 01:28
- 更新类型: **major** 🚀
- 更新说明: **跨平台架构升级 - YouTube全面支持**

### 🎯 核心架构升级
- **平台适配器模式**：全新的跨平台架构设计
  - `VideoPlayerAdapter`：统一视频播放器接口
  - `BilibiliAdapter`：B站专用适配器
  - `YouTubeAdapter`：YouTube专用适配器
  - `PlatformService`：智能平台检测与管理

### 🌐 YouTube平台支持
- **YouTube字幕服务** (`YouTubeSubtitleService`)
  - 自动提取YouTube字幕
  - 支持多语言字幕选择
  - 智能字幕同步
- **YouTube视频标签** (`YouTubeVideoTagger`)
  - 视频列表页显示广告标签
  - 支持所有YouTube页面类型
  - 彩色标签区分不同广告类型
- **DeArrow API集成**
  - 去除标题党和缩略图诱饵
  - 社区驱动的内容改进

### 🛡️ 通用广告跳过
- **UniversalAdSkipService**：跨平台广告跳过服务
  - 支持B站和YouTube
  - SponsorBlock深度集成
  - 智能广告检测与跳过
  - 进度条广告段标记
  - 多种广告类型识别

### ⚡ 性能与稳定性
- **TaskManager任务管理器**
  - 任务上下文隔离
  - 视频切换时自动取消旧任务
  - 防止数据混乱和重复处理
- **LogDecorator日志装饰器**
  - 统一的日志格式
  - 性能监控集成
  - 调试信息增强
- **请求工厂优化** (`RequestFactory`)
  - 统一的API请求配置
  - 重试机制改进
  - 速率限制保护

### 🔧 其他改进
- 全站支持：所有网站可用基础功能
- 改进的错误处理和用户提示
- 更完善的平台检测逻辑
- 优化的资源加载策略

---

## v1.1.34 (2025-10-26 01:23)
- 更新时间: 2025-10-26 01:23
- 更新类型: patch
- 更新说明: 🌍 全站支持
  - 扩展脚本匹配范围到所有网站（*://*/*）
  - 通用功能现在在任何网站都可用：
    - 📸 视频截图功能
    - 🎬 播放速度控制
    - 📝 选中文字保存笔记
    - ⚙️ 快捷键设置
  - 非B站/YouTube网站显示浮动控制按钮
  - B站和YouTube保留完整功能，其他网站使用基础功能

---

## v1.1.33 (2025-10-26 01:15)
- 更新时间: 2025-10-26 01:15
- 更新类型: patch
- 更新说明: 🐛 **修复粉色小球呼吸效果问题**
  - 问题：AI总结开始时小球就停止呼吸效果，应该在总结结束后才停止
  - 原因：TaskManager执行任务时没有触发 AI_SUMMARY_START 事件
  - 修复：在创建AI总结任务后立即触发该事件，确保小球呼吸效果正常显示

---

## v1.1.32 (2025-10-26 01:09)
- 更新时间: 2025-10-26 01:09
- 更新类型: patch
- 更新说明: 🎨 **优化 Notion 页面结构**
  - 🗑️ **移除视频信息部分**：页面更简洁，直接展示核心内容
  - 🔄 **调整内容顺序**：时间戳段落移到视频总结前面，符合逻辑顺序
  - 🐛 **修复字幕重复标题**：移除子页面中多余的 heading_1 标题块
  - 📐 **改进分隔线逻辑**：只在有前置内容时添加分隔线，避免页面顶部出现分隔线

---

## v1.1.31 (2025-10-26 00:54)
- 更新时间: 2025-10-26 00:54
- 更新类型: patch
- 更新说明: 🎯 **统一自动和手动发送功能**
  - ✨ **内容完全一致**：自动和手动发送现在使用相同的内容，只是触发时机不同
  - 🔄 **统一发送方法**：创建 sendToNotion 核心方法，所有发送路径都调用它
  - 📋 **遵循用户配置**：根据内容选项（视频信息、视频总结、时间戳段落、字幕内容）发送勾选的内容
  - 📝 **字幕子页面优化**：字幕作为子页面存储，主页面显示美化的块引用链接
  - 🗑️ **移除冗余代码**：删除旧的 sendSubtitle 方法，避免混淆
  - 🔧 **修复自动发送逻辑**：
    - AI总结完成后自动发送所有配置内容
    - 没有AI总结时，字幕加载完成后也能自动发送
  - 💅 **改进块引用样式**：子页面链接使用蓝色粗体，更清晰地标识为引用

---

## v1.1.30 (2025-10-26 00:37)
- 更新时间: 2025-10-26 00:37
- 更新类型: patch
- 更新说明: 🚀 **重构 Notion 集成功能**
  - ✨ **修复 AI 总结自动发送**：移除 pageId 检查，允许创建新页面并发送
  - ✨ **手动发送包含完整内容**：点击 Notion 按钮现在会发送 AI 总结和字幕
  - 📝 **字幕改为子页面**：字幕不再分块写入主页面，而是创建独立的子页面
  - 🔗 **主页面添加子页面链接**：在主页面中添加指向字幕子页面的链接
  - 🎯 **新增 sendComplete 方法**：统一处理手动发送的完整内容
  - 📦 **优化存储结构**：主页面包含视频信息、AI总结和时间戳段落，字幕独立存储

---

## v1.1.29 (2025-10-26 00:24)
- 更新时间: 2025-10-26 00:24
- 更新类型: patch
- 更新说明: 🔧 **修复 AI 段落总结 JSON 解析错误**
  - 🐛 修复 AI 返回的 JSON 格式错误（数组元素之间缺少逗号）
  - ✨ 添加自动修复机制，在 }{ 之间自动插入逗号
  - 📝 改进 JSON 提示词，明确要求元素之间用逗号分隔
  - 🔄 统一 ConfigManager 和 AIService 中的提示词格式
  - 💡 增加格式示例，引导 AI 返回正确的 JSON 格式

---

## v1.1.28 (2025-10-26 00:23)
- 更新时间: 2025-10-26 00:23
- 更新类型: patch
- 更新说明: 🐛 **修复通用广告跳过服务初始化错误**
  - 🔧 修复 "e.get is not a function" 错误
  - ✅ 为Bilibili平台添加配置包装器，提供get/set方法
  - ✅ 统一YouTube和Bilibili的配置接口，使用localStorage存储
  - 📦 确保UniversalAdSkipService在两个平台都能正常初始化

---

## v1.1.27 (2025-10-26 00:15)
- 更新时间: 2025-10-26 00:15
- 更新类型: patch
- 更新说明: 🎬 **修复 YouTube 播放页面 UI 显示问题**
  - 🔴 修复粉色小球在YouTube播放器上不显示（调整定位从right: -30px改为right: 10px）
  - 📺 修复字幕面板在YouTube侧边栏不显示（重置position和left/top样式）
  - 🎯 为YouTube播放器内的小球添加特定样式和z-index确保显示
  - 🖱️ 添加小球点击事件处理，支持切换字幕面板和手动获取字幕
  - 🎛️ 修复小球状态更新冲突，移除onclick覆盖，统一使用addEventListener
  - 📱 支持YouTube全屏时自动调整小球位置避开控制栏

---

## v1.1.26 (2025-10-26 00:11)
- 更新时间: 2025-10-26 00:11
- 更新类型: patch
- 更新说明: 🚀 **大幅改进 SponsorBlock API 可靠性和性能**
  - 🔄 实现完整的重试机制，支持指数退避和智能延迟
  - ⚡ 添加请求队列管理和并发控制，防止流量速率限制
  - 🎯 针对429（请求频繁）错误特殊处理，允许更多重试次数
  - ⏱️ 增加超时时间到15秒，适应网络波动
  - 🔀 添加随机抖动避免大量请求同时重试
  - 📊 详细的调试日志，方便排查网络问题

---

## v1.1.25 (2025-10-26 00:04)
- 更新时间: 2025-10-26 00:04
- 更新类型: patch
- 更新说明: 🐛 **修复 AI 服务调用错误**
  - 🔧 修复 AIService 调用不存在的 `_withErrorHandling` 方法导致的错误
  - ✅ 删除多余的错误处理包装，代码本身已有 try-catch 处理
  - ✅ 修复了影响 Bilibili 和其他网站的 AI 总结功能

---

## v1.1.24 (2025-10-26 00:02)
- 更新时间: 2025-10-26 00:02
- 更新类型: patch
- 更新说明: 🐛 **修复 YouTube 字幕服务启动错误**
  - 🔧 修复 MutationObserver 在 document.body 不存在时导致的 TypeError
  - ✅ 添加 DOM 加载状态检查，确保页面元素就绪后再设置观察器
  - ✅ 增加错误处理，防止观察器设置失败影响其他功能

---

## v1.1.23 (2025-10-25 23:50)
- 更新时间: 2025-10-25 23:50
- 更新类型: patch
- 更新说明: 🎯 **优化YouTube页面检测和UI布局**
  - ✨ 字幕拦截仅在YouTube播放页面(/watch)生效
  - ✨ UI元素仅在视频播放页面创建，避免在其他页面显示
  - 🔧 智能页面检测，监听YouTube的SPA导航变化
  - 🔧 离开播放页面时自动清理已捕获的数据
  - 📍 YouTube上字幕面板显示在侧边栏，与B站布局保持一致
  - 📍 优先在相关视频上方显示，保持良好的视觉层级

---

## v1.1.22 (2025-10-25 23:38)
- 更新时间: 2025-10-25 23:38
- 更新类型: patch
- 更新说明: 🎉 **重大更新：全面支持YouTube平台**
  - ✨ 新增YouTube字幕提取功能（支持JSON3格式）
  - ✨ 新增跨平台服务架构（PlatformService）
  - ✨ YouTube字幕自动拦截和解析
  - ✨ AI总结支持YouTube视频
  - ✨ Notion集成支持YouTube内容
  - ✨ 段落总结和时间戳跳转功能
  - 🔧 优化字幕解析算法，智能过滤音效标记
  - 🔧 改进请求拦截机制，直接捕获响应数据
  - 📝 更新脚本名称为"Bilibili & YouTube Tools"

---

## v1.1.21 (2025-10-25 23:20)
- 更新时间: 2025-10-25 23:20
- 更新类型: patch
- 更新说明: 🔐 **修复YouTube Trusted Types安全策略错误**
  - 移除innerHTML的使用，改用DOM操作方法
  - 新增createTagContent方法，使用createElement构建标签内容
  - 解决"Failed to set innerHTML: requires TrustedHTML"错误
  - 保持原有的视觉效果和功能不变
  - 兼容YouTube的内容安全策略（CSP）

---

## v1.1.20 (2025-10-25 23:10)
- 更新时间: 2025-10-25 23:10
- 更新类型: patch
- 更新说明: 🏷️ **支持YouTube新版布局的广告标签显示**
  - 添加对yt-thumbnail-view-model新元素的支持
  - 支持yt-lockup-view-model新布局结构
  - 更新时长获取逻辑，支持新的.yt-badge-shape__text元素
  - 改进缩略图容器查找，兼容新旧两种布局
  - 确保广告标签在新版YouTube界面正确显示在左上角

---

## v1.1.19 (2025-10-25 23:03)
- 更新时间: 2025-10-25 23:03
- 更新类型: patch
- 更新说明: 🎯 **修复YouTube进度条广告标记无法显示问题**
  - 重写addProgressMarkers方法，正确处理YouTube进度条结构
  - 提高z-index至40，避免被YouTube元素覆盖
  - 优化标记插入位置，确保在正确的DOM层级
  - 添加视频时长有效性检查，避免无效渲染
  - 为不同广告类型使用专属颜色（sponsor绿色、intro青色等）
  - 改进鼠标悬停效果和交互体验
  - 添加中文类别名称显示
  - 修复标记容器定位问题

---

## v1.1.18 (2025-10-25 22:53)
- 更新时间: 2025-10-25 22:53
- 更新类型: patch
- 更新说明: 🔧 **修复UniversalAdSkipService频繁调用和缓存问题**
  - 添加完整的缓存机制（30分钟有效期）
  - 优化原生广告检测，添加防抖和频率限制（5秒间隔）
  - 避免重复日志输出，只在有实际变化时记录
  - 优化URL变化处理，同一视频不重新初始化
  - 添加自动缓存清理（每10分钟）
  - 修复进度条标记重复渲染问题
  - 使用WeakSet避免内存泄漏

---

## v1.1.17 (2025-10-25 22:51)
- 更新时间: 2025-10-25 22:51
- 更新类型: patch
- 更新说明: 🎨 **YouTube标签B站风格美化**
  - 采用B站风格的渐变背景和圆角设计
  - 为每种广告类型添加对应的emoji图标（💰赞助、📢推广、🎬片头等）
  - 优化标签排版，emoji和文字完美对齐
  - 添加炫酷的动画效果（滑入缩放、悬停高亮）
  - 支持多类别标签显示（显示+N标记）
  - 添加shimmer光泽动效，更具视觉吸引力
  - 使用更精致的阴影和模糊效果
  - 字体优化支持中文（PingFang SC、Microsoft YaHei）

---

## v1.1.16 (2025-10-25 22:40)
- 更新时间: 2025-10-25 22:44
- 更新类型: patch
- 更新说明: ⚡ **优化YouTube视频标签性能与检测**
  - 改用WeakSet追踪处理过的元素，避免内存泄漏
  - 实现真正的异步并发处理（最多3个同时请求）
  - 添加智能速率限制（100ms请求间隔）
  - 增强DOM变化检测（监听属性变化、YouTube特定事件）
  - 缓存添加TTL机制（30分钟过期）
  - 自动清理过期缓存（每5分钟）
  - 改进防抖处理（200ms延迟合并）
  - 添加定期扫描作为备用方案（10秒间隔）

---

## v1.1.16 (2025-10-25 22:40)
- 更新时间: 2025-10-25 22:40
- 更新类型: patch
- 更新说明: [待填写更新说明]

---

## v1.1.15 (2025-10-25 22:22)
- 更新时间: 2025-10-25 22:22
- 更新类型: patch
- 更新说明: 🏷️ **YouTube视频广告标签功能**
  - 新增YouTubeVideoTagger服务，自动检测并标记含广告的视频
  - 支持YouTube首页、频道页、搜索结果等所有视频列表
  - 通过SponsorBlock API获取社区提交的广告段落信息
  - 在视频缩略图左上角显示彩色标签（赞助、推广、片头等）
  - 智能缓存机制，避免重复请求
  - 支持YouTube SPA导航，动态加载的视频也能被标记

---

## v1.1.14 (2025-10-25 22:04)
- 更新时间: 2025-10-25 22:04
- 更新类型: patch
- 更新说明: 🔧 **修复SponsorBlock API使用问题**
  - 修正categories参数格式错误（从嵌套数组改为多个category参数）
  - DeArrowAPI现在正确传递多个category参数
  - UniversalAdSkipService添加categories参数支持
  - RequestFactory更新支持自定义广告类别
  - 确保能获取所有类型的广告段落（sponsor、intro、outro等）

---

## v1.1.13 (2025-10-25 21:48)
- 更新时间: 2025-10-25 21:48
- 更新类型: patch
- 更新说明: 🌐 **增强多平台视频信息识别**
  - 新增YouTube视频信息识别（视频ID、标题、创作者）
  - 支持通用视频网站的基础信息获取（通过meta标签）
  - getVideoInfo增加platform字段，标识当前平台
  - 新增通用视频辅助函数（getVideoElement、hasVideo、getVideoDuration等）
  - 为跨平台功能扩展奠定基础

---

## v1.1.12 (2025-10-25 21:29)
- 更新时间: 2025-10-25 21:29
- 更新类型: patch
- 更新说明: [待填写更新说明]

---

## v1.1.11 (2025-10-25 21:13)
- 更新时间: 2025-10-25 21:13
- 更新类型: patch
- 更新说明: 🚫 **YouTube广告识别和跳过功能**
  - 新增通用广告跳过服务，支持YouTube和Bilibili双平台
  - 集成DeArrow API，获取社区提交的广告段落
  - 自动检测YouTube进度条原生广告标记（黄色标记）
  - 可配置自动跳过、静音、延迟跳过等多种模式
  - 支持多种广告类别：赞助商、自我推广、互动提醒、开场、片尾等
  - 采用平台适配器模式，解耦不同平台的实现细节
  - 进度条显示广告段落标记，点击可快速跳过
  - 油猴菜单新增YouTube广告设置选项

---

## v1.1.10 (2025-10-25 20:52)
- 更新时间: 2025-10-25 20:52
- 更新类型: patch
- 更新说明: 🔒 **视频切换数据隔离和任务管理**
  - 修复视频切换时AI总结/字幕错误绑定的严重bug
  - 新增TaskManager任务管理器，确保数据正确绑定到对应视频
  - 视频切换时自动取消旧视频的运行中任务
  - AI总结完成后后台发送到Notion，使用固定的视频信息
  - 添加已处理视频记录，避免重复自动处理（30天过期）
  - 手动触发会清除处理记录，允许重新处理

---

## v1.1.9 (2025-10-25 20:45)
- 更新时间: 2025-10-25 20:45
- 更新类型: patch
- 更新说明: 🐛 **修复Notion API 100个块限制问题**
  - 修复发送字幕时超过100个块导致API验证失败的问题
  - 实现智能分批发送功能，每批最多95个块
  - 字幕数量上限从100条提升到500条
  - 优化`appendToPage`方法，支持自动分批处理
  - 添加批次发送进度日志，便于调试

---

## v1.1.8 (2025-10-25 20:34)
- 更新时间: 2025-10-25 20:34
- 更新类型: patch
- 更新说明: 优化日志系统，在调试模式下输出详细日志，普通模式只显示错误信息。新增日志装饰器工具，支持模块化日志管理

---

## v1.1.7 (2025-10-25 20:05)
- 更新时间: 2025-10-25 20:05
- 更新类型: patch
- 更新说明: 🔧 **修复超时错误**
  - 增加 SponsorBlock 和 VideoQuality API 请求超时时间从 5秒 到 10秒
  - 增强 SponsorBlock 错误处理，防止未捕获的 Promise rejection
  - SponsorBlock 初始化失败不再影响主流程
  - 减少控制台 Timeout 错误输出

---

## v1.1.6 (2025-10-25 19:57)
- 更新时间: 2025-10-25 19:57
- 更新类型: patch
- 更新说明: 修复段落点击跳转时的 notification.show 错误，改为使用 notification.info 方法

---

## v1.1.5 (2025-10-25 19:43)
- 更新时间: 2025-10-25 19:43
- 更新类型: patch
- 更新说明: 🎯 **AI总结优化**
  - 更明确prompt1不包含时间戳，专注内容总结
  - prompt2专门用于生成带时间戳的段落总结
  - 两个AI请求保持并行异步发送，提高效率
  - 只有两个AI总结都成功才创建Notion笔记，确保数据完整性

---

## v1.1.4 (2025-10-25 19:43)
- 更新时间: 2025-10-25 19:43
- 更新类型: patch
- 更新说明: 🎨 **交互体验优化**
  - AI总结生成中时点击AI按钮会提示"正在生成中"，避免重复请求
  - 已有AI总结时点击AI按钮会弹窗确认是否重新生成
  - 选择"取消"会切换到总结标签页查看现有总结
  - 选择"确定"会清除缓存并重新生成总结
  - AI总结生成中时点击Notion按钮会提示"请稍后"，避免发送不完整数据

---

## v1.1.3 (2025-10-25 19:39)
- 更新时间: 2025-10-25 19:39
- 更新类型: patch
- 更新说明: 🐛 **修复Notion API blocks数量超限问题**
  - 将Markdown内容合并为更少的blocks（每块最多10行或1500字符）
  - 限制时间戳段落最多显示20个，避免blocks过多
  - 添加总blocks数量限制，超过100个时自动截断并添加提示
  - 解决"body.children.length should be ≤ 100"错误

---

## v1.1.2 (2025-10-25 19:26)
- 更新时间: 2025-10-25 19:26
- 更新类型: patch
- 更新说明: 🐛 **Bug修复**
  - 修复NotionService缺少formatTime函数导入的问题
  - 修复发送字幕到Notion时的"formatTime is not defined"报错
  - 确保AI请求超时处理正常工作

---

## v1.1.1 (2025-10-25 19:14)
- 更新时间: 2025-10-25 19:14
- 更新类型: patch
- 更新说明: ✨ **新增AI广告检测功能**
  - 对超过5分钟的视频自动进行广告检测
  - 使用第三个异步AI请求，与总结和段落并行处理
  - 检测到的广告自动添加到进度条标记
  - 支持自动跳过检测到的广告段落
- 🎯 **性能优化**
  - 三个AI请求完全异步并行执行，节省处理时间
  - 只对长视频（>5分钟）启用广告检测，避免不必要的API调用
- 🔧 **技术改进**
  - 重构_makeAIRequest方法支持多种响应类型
  - 添加广告段落与SponsorBlock系统的集成
  - 广告段落使用sponsor类别，优先级设为100

---

## v1.1.6 (2025-10-25)
- 更新时间: 2025-10-25
- 更新类型: minor
- 更新说明: Notion集成功能重大改进和修复

### 🎯 主要功能改进
  - **Notion内容结构重构**：改进页面组织结构，所有内容直接添加到主页面
  - **AI总结自动发送**：AI总结完成后自动发送到Notion
  - **内容选项配置**：支持独立选择发送视频信息、AI总结、时间戳段落、字幕内容

### 🐛 修复的问题
  - **完全修复Notion API错误**：
    - 修复rich_text格式问题，为所有元素添加必需的`type: 'text'`属性
    - 移除无效的child_page块类型
    - 增强block结构验证，确保所有类型属性正确
    - 改进数据类型验证，确保文本内容为有效字符串
  
### 📝 优化改进
  - 限制字幕显示数量（最多100条）避免页面过长
  - 使用分隔线和标题更好地组织内容结构
  - 添加详细的错误日志，便于问题排查
  - 改进_parseRichText方法，支持粗体、代码等格式

### 📋 笔记功能增强
  - 支持AI总结笔记的保存和管理
  - 截图可按时间戳自动嵌入到对应段落
  - 改进笔记面板UI，更好地展示AI总结结构

---

## v1.0.15 (2025-10-25 01:48)
- 更新类型: patch
- 更新说明: 重构Notion笔记结构，使用子页面架构
  - **子页面架构**: AI总结和字幕不再直接添加到主笔记，改为创建子页面并引用
  - **新增方法**: _createChildPage创建子页面（父页面是普通页面，不是数据库）
  - **主笔记结构优化**: 视频信息 → 时间戳段落 → AI总结引用 → 字幕引用
  - **子页面创建**: 
    - AI总结子页面：包含完整的Markdown格式总结
    - 字幕内容子页面：包含所有字幕文本
  - **不填充总结字段**: _buildProperties方法新增summary参数，传入null时不填充"总结"字段
  - **减少blocks**: 主笔记只包含核心信息，详细内容在子页面中
  - **提升性能**: 减少主笔记blocks数量，截图查找速度更快
  - **清晰结构**: 主笔记简洁，子页面详细，信息组织更合理

---

## v1.0.15 (2025-10-25 01:44)
- 更新时间: 2025-10-25 01:44
- 更新类型: patch
- 更新说明: 修复全局错误处理器的类型安全问题
  - **修复TypeError**: 修复`t.includes is not a function`错误，使用`String()`安全转换message和source
  - **过滤第三方错误**: 添加nc-loader（阿里云验证码）和addIceCandidate错误过滤
  - **增强Promise错误处理**: 安全获取reason信息，避免类型错误
  - **更健壮的错误处理**: 所有字符串检查前先确保变量是字符串类型
  - **调试日志**: 为被过滤的错误添加调试日志，便于排查问题

---

## v1.0.14 (2025-10-25 01:42)
- 更新时间: 2025-10-25 01:42
- 更新类型: patch
- 更新说明: 优化Markdown解析器，修复标题识别和减少blocks数量
  - **修复标题识别bug**: 使用正则`/^(#{1,3})\s+(.+)$/`匹配标题，正确识别`### **关键总结**`
  - **减少blocks数量**: 合并连续的普通段落为一个paragraph，显著减少blocks（提升截图查找速度）
  - **简化rich text解析**: 移除斜体支持，只保留粗体`**text**`和代码`` `code` ``格式
  - **换行支持增强**: 正确处理多行文本的换行，在paragraph内部保留换行
  - **性能优化**: flushParagraphs机制批量处理段落，减少API请求体积
  - **调试日志**: 显示"blocks（优化后）"，便于监控优化效果

---

## v1.0.13 (2025-10-25 01:38)
- 更新时间: 2025-10-25 01:38
- 更新类型: patch
- 更新说明: 优化AGENTS.md开发指南，突出版本管理流程
  - **核心原则重组**: 将版本管理提升到核心原则第2位，强调重要性
  - **版本管理详解**: 详细说明`npm run bump`命令的作用和后续步骤
  - **开发流程简化**: 精简为4步：修改代码 → 更新版本 → 填写说明 → 提交代码
  - **结构优化**: 使用表格展示核心功能模块，更直观清晰
  - **检查清单**: 添加AI助手修改前后的检查清单，确保流程规范
  - **精简内容**: 删除冗余示例代码，保留最实用的开发提示
  - **标题优化**: 改为"AI开发助手指南"，明确文档定位

---

## v1.0.12 (2025-10-25 01:35)
- 更新时间: 2025-10-25 01:35
- 更新类型: patch
- 更新说明: AI总结在Notion中以Markdown格式显示
  - **新增Markdown解析器**: _convertMarkdownToNotionBlocks方法，完整支持Markdown语法
  - **支持的格式**:
    - 标题: `#` (heading_1), `##` (heading_2), `###` (heading_3)
    - 列表: `-` 或 `*` (bulleted_list), `1.` (numbered_list)
    - 文本样式: `**粗体**`, `*斜体*`, `` `代码` ``
    - 其他: `---` (分隔线), `> 引用`, ` ```代码块``` `
  - **Rich Text解析**: _parseRichText方法支持行内格式（粗体、斜体、代码）
  - **视频总结优化**: AI总结现在完美保留Markdown格式，在Notion中呈现更美观
  - **调试日志**: 添加详细的转换日志，记录blocks生成过程

---

## v1.0.11 (2025-10-25 01:32)
- 更新时间: 2025-10-25 01:32
- 更新类型: patch
- 更新说明: 删除字幕面板左上角的AI助手图标
  - 移除了subtitle-header-left中的AI助手图标元素
  - 删除了.subtitle-status-icon相关的CSS样式
  - 删除了ICONS.AI_ASSISTANT图标定义
  - 界面更简洁清爽

---

## v1.0.10 (2025-10-25 01:29)
- 更新时间: 2025-10-25 01:29
- 更新类型: patch
- 更新说明: 重构Notion截图智能插入功能，优化段落结构
  - **NotionService.sendAISummary**: 使用toggle block创建段落，支持添加children
  - **ScreenshotService.insertScreenshotAtTimestamp**: 改进查找逻辑，根据时间戳精准定位toggle block
  - **智能匹配算法**: 找到最接近且不大于截图时间的段落进行插入
  - **详细调试日志**: 完整记录段落构建、时间戳解析、block查找和插入过程
  - **兼容性**: 同时支持toggle和bulleted_list_item两种格式
  - **结构优化**: 每个段落现在是独立的toggle block，可以折叠展开，截图作为children嵌入其中

---

## v1.0.9 (2025-10-25 01:25)
- 更新时间: 2025-10-25 01:25
- 更新类型: patch
- 更新说明: 修复AI总结完成后自动发送Notion功能
  - 修复了main.js中AI_SUMMARY_COMPLETE事件监听器调用错误的方法
  - 从调用sendSubtitle改为正确调用sendAISummary
  - 现在AI总结完成后会根据Notion内容选项正确发送AI总结内容到Notion
  - 添加了成功和失败的通知提示

---

## v1.0.8 (2025-10-22 21:18)
- 更新时间: 2025-10-22 21:18
- 更新类型: patch
- 更新说明: 修复Notion发送字幕时的TypeError错误
  - 修复了发送字幕到Notion时`substring is not a function`错误
  - 正确处理AI总结可能是对象（含markdown和segments）或字符串的情况
  - 兼容新旧版本的AI总结数据格式

---

## v1.0.7 (2025-10-22 18:04)
- 更新时间: 2025-10-22 18:04
- 更新类型: patch
- 更新说明: 减少NotesService中鼠标事件日志输出，避免控制台日志过多
  - 注释掉mouseup/mousedown基础事件日志和鼠标位置日志
  - 只保留重要的操作日志（如检测到文本选择、保存笔记等）

---

## v1.0.6 (2025-10-22 17:54)
- 更新时间: 2025-10-22 17:54
- 更新类型: patch
- 更新说明: 优化字幕和AI段落交互体验
  - 字幕列表滚动位置改为顶部对齐：当前播放字幕显示在列表顶部而非中心
  - AI段落元素完全支持点击跳转：整个段落区域都可点击，不仅限于时间按钮
  - 添加点击反馈动画：点击AI段落时显示视觉反馈效果
  - 增强当前播放字幕高亮：添加发光动画使其更明显
  - 优化滚动边距：顶部保留20px边距以改善视觉效果

---

## v1.0.5 (2025-10-22 17:44)
- 更新时间: 2025-10-22 17:44
- 更新类型: patch
- 更新说明: 移除AI总结加载中效果
  - 修复"正在生成总结..."一直显示的问题
  - 移除UIRenderer.js中的AI总结加载状态显示
  - 移除main.js中的加载状态插入逻辑
  - 移除AI图标的loading动画状态

---

## v1.0.4 (2025-10-22 17:33)
- 更新时间: 2025-10-22 17:33
- 更新类型: patch
- 更新说明: 字幕自动滚动功能完全重构
  - 创建独立的 SubtitleScrollManager 模块，解耦滚动管理逻辑
  - 删除 EventHandlers.js 和 SubtitleEventHandler.js 中的旧滚动代码
  - 实现更精准的自动跟随：始终将当前播放字幕居中显示
  - 改进用户滚动检测机制，避免误判
  - 优化滚动性能：200ms更新频率，更流畅的体验
  - 支持配置化：滚动行为、位置、检测延迟等均可配置

---

## v1.0.3 (2025-10-22 17:27)
- 更新时间: 2025-10-22 17:27
- 更新类型: patch
- 更新说明: 
  - 修复AIService.js缺少logger导入导致的ReferenceError错误
  - 修复UIRenderer.js缺少logger导入问题  
  - 修复markdown解析空代码块显示问题，自动清理空的```代码块
  - 改进parseMarkdown方法，正确处理代码块内容

---

## v1.0.2 (2025-10-22 17:21)
- 更新时间: 2025-10-22 17:21
- 更新类型: patch
- 更新说明: 修复字幕切换过快导致关闭失败的问题，将切换延迟从1秒增加到2秒

---

## v1.0.1 (2025-10-22 17:18)
- 更新时间: 2025-10-22 17:18
- 更新类型: patch
- 更新说明: 添加自动版本管理系统，实现版本号自动更新和历史记录

---
