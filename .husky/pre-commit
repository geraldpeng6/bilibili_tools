#!/usr/bin/env sh

# 颜色定义
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

# 检查是否有源代码变更
if git diff --cached --name-only | grep -qE "^src/.*\.(js|ts|jsx|tsx)$"; then
  echo "${YELLOW}⚠️  检测到源代码变更${NC}"
  echo "${YELLOW}📦 是否需要更新版本号？${NC}"
  echo ""
  echo "可用命令："
  echo "  ${GREEN}npm run bump${NC}      - 增加补丁版本 (x.x.+1)"
  echo "  ${GREEN}npm run version:minor${NC} - 增加次版本 (x.+1.0)"
  echo "  ${GREEN}npm run version:major${NC} - 增加主版本 (+1.0.0)"
  echo ""
  echo "${YELLOW}如果已更新版本，请忽略此提示${NC}"
  echo "─────────────────────────────────────"
fi

# 构建 user.js
npm run build

# 将构建产物添加到暂存区
git add dist/bilibili_tools.user.js
